(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))l(t);new MutationObserver(t=>{for(const e of t)if(e.type==="childList")for(const r of e.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&l(r)}).observe(document,{childList:!0,subtree:!0});function c(t){const e={};return t.integrity&&(e.integrity=t.integrity),t.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?e.credentials="include":t.crossOrigin==="anonymous"?e.credentials="omit":e.credentials="same-origin",e}function l(t){if(t.ep)return;t.ep=!0;const e=c(t);fetch(t.href,e)}})();document.addEventListener("DOMContentLoaded",()=>{const h=document.querySelectorAll(".pad"),a=document.getElementById("start-btn"),c=document.getElementById("replay-btn"),l=document.getElementById("high-score"),t=document.getElementById("reset-btn");if(!a||!c||!l){console.error("Missing essential buttons. Check HTML IDs.");return}let e=[],r=[],d=0,i=!1;const u="http://localhost:4000/api/v1";a.addEventListener("click",p),c.addEventListener("click",E),t&&t.addEventListener("click",p);async function p(){try{console.log("Fetching:",`${u}/game-state`);let o=await fetch(`${u}/game-state`,{method:"PUT"});if(!o.ok)throw new Error(`HTTP error! Status: ${o.status}`);let n=await o.json();console.log("Game State Response:",n),e=n.gameState.sequence||[],d=n.gameState.highScore||0,l.textContent=d,f(e)}catch(o){console.error("Error starting game:",o),alert("Failed to start game. Please check backend connection.")}}function E(){if(!e.length){console.warn("No sequence to replay.");return}i=!1,f(e)}function y(o){const n=`http://localhost:3000/sounds/${o}.mp3`;new Audio(n).play().catch(m=>console.error("Audio Error:",m))}function f(o){console.log("Playing sequence:",o),i=!1,r=[],c.disabled=!0;let n=1e3;o.forEach((s,m)=>{setTimeout(()=>{let g=document.getElementById(`pad-${s}`);g?(g.classList.add("active"),y(s),setTimeout(()=>g.classList.remove("active"),300)):console.error("Error: Pad not found for",s)},m*n)}),setTimeout(()=>{i=!0,c.disabled=!1},o.length*n)}h.forEach(o=>{o.addEventListener("click",()=>{if(!i)return;const n=o.id.replace("pad-","");r.push(n),y(n),r.length===e.length&&S(r)})});async function S(o){i=!1;try{let s=await(await fetch(`${u}/game-state/sequence`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sequence:o})})).json();s.gameState?(e=s.gameState.sequence,d=s.gameState.highScore,l.textContent=d,o=[],setTimeout(()=>f(e),1e3)):document.getElementById("failure-modal").style.display="block"}catch(n){console.error("Error validating sequence:",n),alert("Error connecting to backend. Try again later.")}}});
